/*! angular-google-maps 0.0.0 2013-06-06
 *  AngularJS directives for Google Maps
 *  git: https://github.com/nlaplante/angular-google-maps.git
 */
angular.module("google-maps",[]),angular.module("google-maps").directive("googleMap",["$log","$timeout","$filter",function(a,b){"use strict";function c(a){return angular.isDefined(a)&&null!==a&&a===!0||"1"===a||"y"===a||"true"===a}return{restrict:"ECMA",transclude:!0,replace:!1,template:'<div class="angular-google-map"><div class="angular-google-map-container"></div><div ng-transclude style="display: none"></div></div>',scope:{center:"=center",zoom:"=zoom",latitude:"=latitude",longitude:"=longitude",markers:"=markers",refresh:"&refresh",windows:"=windows",events:"=events"},controller:["$scope",function(a){this.getMap=function(){return a.map}}],link:function(d,e,f){if(!angular.isDefined(d.center)||!angular.isDefined(d.center.latitude)||!angular.isDefined(d.center.longitude))return a.error("angular-google-maps: could not find a valid center property"),void 0;if(!angular.isDefined(d.zoom))return a.error("angular-google-maps: map zoom property not set"),void 0;angular.element(e).addClass("angular-google-map");var g={options:{}};f.options&&(g.options=angular.fromJson(f.options));var h=new google.maps.Map(e.find("div")[1],angular.extend(g,{center:new google.maps.LatLng(d.center.latitude,d.center.longitude),draggable:c(f.draggable),zoom:d.zoom,mapTypeId:google.maps.MapTypeId.ROADMAP})),i=!1;if(google.maps.event.addListener(h,"dragstart",function(){i=!0}),google.maps.event.addListener(h,"dragend",function(){i=!1}),google.maps.event.addListener(h,"drag",function(){var a=h.center;b(function(){d.$apply(function(){d.center.latitude=a.lat(),d.center.longitude=a.lng()})})}),google.maps.event.addListener(h,"zoom_changed",function(){d.zoom!=h.zoom&&b(function(){d.$apply(function(){d.zoom=h.zoom})})}),google.maps.event.addListener(h,"center_changed",function(){var a=h.center;b(function(){d.$apply(function(){h.dragging||(d.center.latitude=a.lat(),d.center.longitude=a.lng())})})}),angular.isDefined(d.events)&&null!==d.events&&angular.isObject(d.events)){var j=function(a){return function(){d.events[a].apply(d,[h,a,arguments])}};for(var k in d.events)d.events.hasOwnProperty(k)&&angular.isFunction(d.events[k])&&google.maps.event.addListener(h,k,j(k))}if(c(f.markClick)){var l=null;google.maps.event.addListener(h,"click",function(a){null===l?(l={latitude:a.latLng.lat(),longitude:a.latLng.lng()},d.markers.push(l)):(l.latitude=a.latLng.lat(),l.longitude=a.latLng.lng()),b(function(){d.latitude=l.latitude,d.longitude=l.longitude,d.$apply()})})}d.map=h,google.maps.event.trigger(h,"resize"),angular.isUndefined(d.refresh())||d.$watch("refresh()",function(a,b){if(a&&!b){var d=new google.maps.LatLng(a.latitude,a.longitude);c(f.pan)?h.panTo(d):h.setCenter(d)}}),d.$watch("center",function(a,b){if(a!==b&&!i){var d=new google.maps.LatLng(a.latitude,a.longitude);c(f.pan)?h.panTo(d):h.setCenter(d)}},!0),d.$watch("zoom",function(a,b){a!==b&&h.setZoom(a)})}}}]),angular.module("google-maps").directive("marker",["$log","$timeout",function(a,b){"use strict";function c(a){return-1!==["false","FALSE",0,"n","N","no","NO"].indexOf(a)}var d={animation:google.maps.Animation.DROP};return{restrict:"ECMA",require:"^googleMap",priority:-1,transclude:!0,template:'<span class="angular-google-map-marker" ng-transclude></span>',replace:!0,scope:{coords:"=coords",click:"&click"},controller:function(a,b){this.getMarker=function(){return b.data("instance")}},link:function(e,f,g,h){return angular.isUndefined(e.coords)||null===e.coords||angular.isUndefined(e.coords.latitude)||angular.isUndefined(e.coords.longitude)?(a.error("marker: no valid coords attribute found"),void 0):(b(function(){var a=angular.extend({},d,{position:new google.maps.LatLng(e.coords.latitude,e.coords.longitude),map:h.getMap(),visible:null!==e.coords.latitude&&null!==e.coords.longitude});angular.isDefined(g.animate)&&c(g.animate)&&delete a.animate;var b=new google.maps.Marker(a);f.data("instance",b),e.$watch("coords",function(a,c){a!==c&&(a?(b.setMap(h.getMap()),b.setPosition(new google.maps.LatLng(a.latitude,a.longitude)),b.setVisible(null!==a.latitude&&null!==a.longitude)):b.setMap(null))},!0),e.$on("$destroy",function(){b.setMap(null)})}),void 0)}}}]),angular.module("google-maps").directive("polyline",["$log","$timeout",function(){"use strict";return{restrict:"ECA",require:"^googleMap",scope:{},link:function(a,b,c,d){d.getMap()}}}]),angular.module("google-maps").directive("window",["$log","$timeout","$compile",function(a,b){"use strict";var c={};return{restrict:"ECMA",template:'<span class="angular-google-maps-window" ng-transclude></span>',transclude:!0,priority:-100,require:["^googleMap","^?marker"],scope:{coords:"=coords",show:"&show"},link:function(a,d,e,f){b(function(){var b=f[0],e=f.length>1?f[1]:null,g=angular.extend({},c,{content:d.html(),position:angular.isDefined(e)?e.getMarker().getPosition():new google.maps.LatLng(a.coords.latitude,a.coords.longitude)}),h=new google.maps.InfoWindow(g);if(angular.isDefined(e)){var i=e.getMarker();i.setClickable(!0);var j;google.maps.event.addListener(i,"click",function(){h.setPosition(i.getPosition()),h.open(b.getMap()),j=i.getVisible(),i.setVisible(!1)}),google.maps.event.addListener(h,"closeclick",function(){i.setVisible(j)})}a.$watch("show()",function(a,c){a!==c&&(a?h.open(b.getMap()):h.close())})},50)}}}]);