/*! angular-google-maps 0.0.0 2013-07-24
 *  AngularJS directives for Google Maps
 *  git: https://github.com/nlaplante/angular-google-maps.git
 */
angular.module("google-maps",[]),function(){this.module=function(a,b){var c,d;return"string"==typeof a&&(a=a.split(".")),c=this[d=a.shift()]||(this[d]={}),c.module||(c.module=this.module),a.length?c.module(a,b):b.call(c)}}.call(this),function(){var a=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};this.module("oo",function(){var b;return b=["extended","included"],this.BaseObject=function(){function c(){}return c.extend=function(c){var d,e,f;for(d in c)e=c[d],a.call(b,d)<0&&(this[d]=e);return null!=(f=c.extended)&&f.apply(0),this},c.include=function(c){var d,e,f;for(d in c)e=c[d],a.call(b,d)<0&&(this.prototype[d]=e);return null!=(f=c.included)&&f.apply(0),this},c}()})}.call(this),function(){this.module("directives.api.utils",function(){return this.GmapUtil={createMarkerOptions:function(a,b,c,d,e){var f;return f=angular.extend({},e,{position:new google.maps.LatLng(b.latitude,b.longitude),map:a.getMap(),icon:c,visible:null!=b.latitude&&null!=b.longitude}),d||delete f.animation,f},createWindowOptions:function(a,b,c,d){return angular.extend({},d,{content:c,position:angular.isObject(a)?a.getPosition():new google.maps.LatLng(b.coords.latitude,b.coords.longitude)})}}})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};this.module("directives.api.models",function(){return this.MarkerModel=function(b){function d(b,c,d,e,f,g,h,i){this.watchDestroy=a(this.watchDestroy,this),this.watchIcon=a(this.watchIcon,this),this.watchCoords=a(this.watchCoords,this),this.destroy=a(this.destroy,this);var j=this;this.index=b,this.iconKey=d.icon,this.coordsKey=d.coords,this.myScope=d.$new(!1),this.myScope.icon="self"===this.iconKey?c:c[this.iconKey],this.myScope.coords="self"===this.coordsKey?c:c[this.coordsKey],this.mapCtrl=e,this.opts=this.createMarkerOptions(this.mapCtrl,this.myScope.coords,this.myScope.icon,i),this.gMarker=new google.maps.Marker(this.opts),google.maps.event.addListener(this.gMarker,"click",function(){return doClick&&null!=this.myScope.click?this.myScope.click():void 0}),f(function(){return j.watchCoords(j.myScope),j.watchIcon(j.myScope),j.watchDestroy(j.myScope)})}return c(d,b),d.include(directives.api.utils.GmapUtil),d.prototype.destroy=function(){return this.myScope.$destroy()},d.prototype.watchCoords=function(a){var b=this;return a.$watch("coords",function(a,c){return a!==c?a?(b.gmap.setMap(b.mapCtrl.getMap()),b.gmap.setPosition(new google.maps.LatLng(a.latitude,a.longitude)),b.gmap.setVisible(null!=a.latitude&&null!=a.longitude)):b.gmap.setMap(void 0):void 0},!0)},d.prototype.watchIcon=function(a){var b=this;return a.$watch("icon",function(a,c){return a!==c?(b.gmap.icon=a,b.gmap.setMap(void 0),b.gmap.setMap(b.mapCtrl.getMap()),b.gmap.setPosition(new google.maps.LatLng(coords.latitude,coords.longitude)),b.gmap.setVisible(coords.latitude&&null!=coords.longitude)):void 0},!0)},d.prototype.watchDestroy=function(a){var b=this;return a.$on("$destroy",function(){return b.gmap.setMap(null),"undefined"!=typeof notifyLocalDestroy&&null!==notifyLocalDestroy?notifyLocalDestroy(b.index):void 0})},d}(oo.BaseObject)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};this.module("directives.api.models",function(){return this.WindowModelFunctions={watchShow:function(a,b,c,d,e,f,g,h){return a.$watch("show()",function(i,j){return i!==j?i?f(a,b,c,d,e,h):g(e):i&&!win.getMap()?f(a,b,c,d,e,h):void 0},!0)},handleClick:function(a,b,c,d,e,f){return null!=c?(google.maps.event.addListener(c,"click",function(){return d.setPosition(c.getPosition()),d.open(b),c.setVisible(e)}),google.maps.event.addListener(d,"closeclick",function(){return c.setVisible(f),a.closeClick()})):void 0},showWindow:function(a,b,c,d,e,f){return a.templateUrl?b.get(a.templateUrl,{cache:c}).then(function(b){var c,g;return g=a.$new(),angular.isDefined(a.templateParameter)&&(g.parameter=a.templateParameter),c=d(b.data)(g),e.setContent(c.get(0)),e.open(f)}):e.open(f)},hideWindow:function(a){return a.close()}}}),this.module("directives.api.models",function(){return this.WindowModel=function(a){function c(a,b,c,d,e,f,g,h,i){this.scope=a,this.opts=b,this.mapCtrl=d,this.markerCtrl=e,this.isIconVisibleOnClick=c,this.initialMarkerVisibility=null!=this.markerCtrl?this.markerCtrl.getVisible():!1,this.$log=f,this.$http=g,this.$templateCache=h,this.$compile=i,this.gWin=new google.maps.InfoWindow(b),this.markerCtrl.setClickable(!0),this.handleClick(this.scope,this.mapCtrl,this.markerCtrl,this.gWin,this.isIconVisibleOnClick,this.initialMarkerVisibility),this.watchShow(a,g,h,this.$compile,this.gWin,this.showWindow,this.hideWindow,this.mapCtrl),this.$log.info(this)}return b(c,a),c.include(directives.api.models.WindowModelFunctions),c}(oo.BaseObject)})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};this.module("directives.api",function(){return this.IMarker=function(b){function d(b,c){this.linkInit=a(this.linkInit,this),this.watchDestroy=a(this.watchDestroy,this),this.watchIcon=a(this.watchIcon,this),this.watchCoords=a(this.watchCoords,this),this.link=a(this.link,this),this.validateLinkedScope=a(this.validateLinkedScope,this);var d;d=this,this.clsName="IMarker",this.$log=b,this.$timeout=c,this.restrict="ECMA",this.require="^googleMap",this.priority=-1,this.transclude=!0,this.replace=!0,this.scope={coords:"=coords",icon:"=icon",click:"&click"}}return c(d,b),d.prototype.DEFAULTS={animation:google.maps.Animation.DROP},d.prototype.isFalse=function(a){return-1!==["false","FALSE",0,"n","N","no","NO"].indexOf(a)},d.prototype.controller=function(a,b){return this.getMarker=function(){return b.data("instance")}},d.prototype.validateLinkedScope=function(a){var b;return b=angular.isUndefined(a.coords)||void 0===a.coords,b&&this.$log.error(this.clsName+": no valid coords attribute found"),b},d.prototype.link=function(a,b,c,d){var e=this;if(!this.validateLinkedScope(a))return this.$timeout(function(){var f;return f=angular.isDefined(c.animate)&&e.isFalse(c.animate),e.linkInit(b,d,a,f,angular.isDefined(c.click)),e.watchCoords(a),e.watchIcon(a),e.watchDestroy(a)})},d.prototype.watchCoords=function(){throw new Exception("Not Implemented!!")},d.prototype.watchIcon=function(){throw new Exception("Not Implemented!!")},d.prototype.watchDestroy=function(){throw new Exception("Not Implemented!!")},d.prototype.linkInit=function(){throw new Exception("Not Implemented!!")},d}(oo.BaseObject)})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};this.module("directives.api",function(){return this.IWindow=function(b){function d(b,c,d,e,f){this.link=a(this.link,this);var g;g=this,this.clsName="IWindow",this.restrict="ECMA",this.template=void 0,this.transclude=!0,this.priority=-100,this.require=["^googleMap","^?marker"],this.scope={coords:"=coords",show:"&show",templateUrl:"=templateurl",templateParameter:"=templateparameter",isIconVisibleOnClick:"=isiconvisibleonclick",closeClick:"&closeclick"},this.$log=b,this.$timeout=c,this.$compile=d,this.$http=e,this.$templateCache=f}return c(d,b),d.include(directives.api.utils.GmapUtil),d.prototype.DEFAULTS={},d.prototype.link=function(){throw new Exception("Not Implemented!!")},d}(oo.BaseObject)})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};this.module("directives.api",function(){return this.Marker=function(b){function d(b,c){this.watchDestroy=a(this.watchDestroy,this),this.watchIcon=a(this.watchIcon,this),this.watchCoords=a(this.watchCoords,this),this.linkInit=a(this.linkInit,this),this.validateLinkedScope=a(this.validateLinkedScope,this);var e;d.__super__.constructor.call(this,b,c),e=this,this.template='<span class="angular-google-map-marker" ng-transclude></span>',this.clsName="Marker",b.info(this),this.markers={},this.mapCtrl=void 0}return c(d,b),d.include(directives.api.utils.GmapUtil),d.prototype.validateLinkedScope=function(a){return d.__super__.validateLinkedScope.call(this,a)||angular.isUndefined(a.coords.latitude)||angular.isUndefined(a.coords.longitude)},d.prototype.linkInit=function(a,b,c,d,e){var f;return this.mapCtrl=b,f=this.createMarkerOptions(b,c.coords,c.icon,d,this.DEFAULTS),this.markers[c.$id]=new google.maps.Marker(f),a.data("instance",this.markers[c.$id]),google.maps.event.addListener(this.markers[c.$id],"click",function(){return e&&null!=c.click?c.click():void 0})},d.prototype.watchCoords=function(a){var b=this;return a.$watch("coords",function(c,d){return c!==d?c?(b.markers[a.$id].setMap(b.mapCtrl.getMap()),b.markers[a.$id].setPosition(new google.maps.LatLng(c.latitude,c.longitude)),b.markers[a.$id].setVisible(null!=c.latitude&&null!=c.longitude)):b.markers[a.$id].setMap(void 0):void 0},!0)},d.prototype.watchIcon=function(a){var b=this;return a.$watch("icon",function(c,d){return c!==d?(b.markers[a.$id].icon=c,b.markers[a.$id].setMap(void 0),b.markers[a.$id].setMap(b.mapCtrl.getMap()),b.markers[a.$id].setPosition(new google.maps.LatLng(coords.latitude,coords.longitude)),b.markers[a.$id].setVisible(coords.latitude&&null!=coords.longitude)):void 0},!0)},d.prototype.watchDestroy=function(a){var b=this;return a.$on("$destroy",function(){return b.markers[a.$id].setMap(null),delete b.markers[a.$id]})},d}(directives.api.IMarker)})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};this.module("directives.api",function(){return this.Markers=function(b){function d(b,c){this.watchDestroy=a(this.watchDestroy,this),this.watchIcon=a(this.watchIcon,this),this.watchCoords=a(this.watchCoords,this),this.createMarkers=a(this.createMarkers,this),this.linkInit=a(this.linkInit,this),this.validateLinkedScope=a(this.validateLinkedScope,this);var e;d.__super__.constructor.call(this,b,c),e=this,this.template='<span class="angular-google-map-markers" ng-transclude></span>',this.clsName="Markers",this.scope.models="=models",this.markers={},this.markersIndex=0,this.mapCtrl=void 0,this.$timeout=c,this.$log.info(this)}return c(d,b),d.prototype.validateLinkedScope=function(a){var b;return b=angular.isUndefined(a.models)||void 0===a.models,b&&this.$log.error(this.clsName+": no valid models attribute found"),d.__super__.validateLinkedScope.call(this,a)||b},d.prototype.linkInit=function(a,b,c,d,e){return this.mapCtrl=b,this.createMarkers(a,c,d,e)},d.prototype.createMarkers=function(a,b){var c,d,e,f,g,h=this;for(f=b.models,g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push(function(c){return h.markers[h.markersIndex]=new directives.api.models.MarkerModel(h.markersIndex,c,b,h.mapCtrl,h.$timeout,h.$log,function(a){return delete h.markers[a]},h.DEFAULTS),h.markersIndex++,a.data("instance",h.markers)}(c));return g},d.prototype.watchCoords=function(a){var b=this;return a.$watch("coords",function(a,c){var d,e,f,g,h;if(a!==c){for(g=b.markers,h=[],e=0,f=g.length;f>e;e++)d=g[e],h.push(d.coordsKey=a);return h}},!0)},d.prototype.watchIcon=function(a){var b=this;return a.$watch("icon",function(a,c){var d,e,f,g,h;if(a!==c){for(g=b.markers,h=[],e=0,f=g.length;f>e;e++)d=g[e],h.push(d.iconKey=a);return h}},!0)},d.prototype.watchDestroy=function(a){var b=this;return a.$on("$destroy",function(){var a,c,d,e,f;for(e=b.markers,f=[],c=0,d=e.length;d>c;c++)a=e[c],f.push(a.destroy());return f})},d}(directives.api.IMarker)})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};this.module("directives.api",function(){return this.Window=function(b){function d(b,c,e,f,g){this.link=a(this.link,this);var h;d.__super__.constructor.call(this,b,c,e,f,g),h=this,this.clsName="Window",this.template='<span class="angular-google-maps-window" ng-transclude></span>',this.$log.info(h)}return c(d,b),d.prototype.link=function(a,b,c,d){var e=this;return this.$timeout(function(){var f,g,h,i;return f=!0,angular.isDefined(c.isiconvisibleonclick)&&(f=a.isIconVisibleOnClick),g=d[0].getMap(),h=d.length>1&&null!=d[1]?d[1].getMarker():void 0,i=e.createWindowOptions(h,a,b.html(),e.DEFAULTS),null!=g?new directives.api.models.WindowModel(a,i,f,g,h,e.$templateCache,e.$compile):void 0},50)},d}(directives.api.IWindow)})}.call(this),angular.module("google-maps").directive("googleMap",["$log","$timeout",function(a,b){"use strict";function c(a){return angular.isDefined(a)&&null!==a&&a===!0||"1"===a||"y"===a||"true"===a}var d={mapTypeId:google.maps.MapTypeId.ROADMAP};return{restrict:"ECMA",transclude:!0,replace:!1,template:'<div class="angular-google-map"><div class="angular-google-map-container"></div><div ng-transclude style="display: none"></div></div>',scope:{center:"=center",zoom:"=zoom",dragging:"=dragging",markers:"=markers",refresh:"&refresh",windows:"=windows",events:"=events"},controller:["$scope",function(a){this.getMap=function(){return a.map}}],link:function(e,f,g){if(!angular.isDefined(e.center)||!angular.isDefined(e.center.latitude)||!angular.isDefined(e.center.longitude))return a.error("angular-google-maps: could not find a valid center property"),void 0;if(!angular.isDefined(e.zoom))return a.error("angular-google-maps: map zoom property not set"),void 0;var h=angular.element(f);h.addClass("angular-google-map");var i={options:{}};if(g.options&&(i.options=angular.fromJson(g.options)),g.type){var j=g.type.toUpperCase();google.maps.MapTypeId.hasOwnProperty(j)?i.mapTypeId=google.maps.MapTypeId[g.type.toUpperCase()]:a.error('angular-google-maps: invalid map type "'+g.type+'"')}var k=new google.maps.Map(h.find("div")[1],angular.extend({},d,i,{center:new google.maps.LatLng(e.center.latitude,e.center.longitude),draggable:c(g.draggable),zoom:e.zoom})),l=!1;if(google.maps.event.addListener(k,"dragstart",function(){l=!0,b(function(){e.$apply(function(a){a.dragging=l})})}),google.maps.event.addListener(k,"dragend",function(){l=!1,b(function(){e.$apply(function(a){a.dragging=l})})}),google.maps.event.addListener(k,"drag",function(){var a=k.center;b(function(){e.$apply(function(b){b.center.latitude=a.lat(),b.center.longitude=a.lng()})})}),google.maps.event.addListener(k,"zoom_changed",function(){e.zoom!=k.zoom&&b(function(){e.$apply(function(a){a.zoom=k.zoom})})}),google.maps.event.addListener(k,"center_changed",function(){var a=k.center;b(function(){e.$apply(function(b){k.dragging||(b.center.latitude=a.lat(),b.center.longitude=a.lng())})})}),angular.isDefined(e.events)&&null!==e.events&&angular.isObject(e.events)){var m=function(a){return function(){e.events[a].apply(e,[k,a,arguments])}};for(var n in e.events)e.events.hasOwnProperty(n)&&angular.isFunction(e.events[n])&&google.maps.event.addListener(k,n,m(n))}e.map=k,google.maps.event.trigger(k,"resize"),angular.isUndefined(e.refresh())||e.$watch("refresh()",function(a,b){if(a&&!b){var d=new google.maps.LatLng(a.latitude,a.longitude);c(g.pan)?k.panTo(d):k.setCenter(d)}}),e.$watch("center",function(a,b){if(a!==b&&!l){var d=new google.maps.LatLng(a.latitude,a.longitude);c(g.pan)?k.panTo(d):k.setCenter(d)}},!0),e.$watch("zoom",function(a,b){a!==b&&k.setZoom(a)})}}}]),angular.module("google-maps").directive("marker",["$log","$timeout",function(a,b){return new directives.api.Marker(a,b)}]),angular.module("google-maps").directive("markers",["$log","$timeout",function(a,b){return new directives.api.Markers(a,b)}]),angular.module("google-maps").directive("polyline",["$log","$timeout",function(a,b){"use strict";function c(a){for(var b=0;b<a.length;b++)if(angular.isUndefined(a[b].latitude)||angular.isUndefined(a[b].longitude))return!1;return!0}function d(a){for(var b=[],c=0;c<a.length;c++)b.push(new google.maps.LatLng(a[c].latitude,a[c].longitude));return b}function e(a,b){for(var c=new google.maps.LatLngBounds,d=0;d<b.length;d++)c.extend(b[d]);a.fitBounds(c)}function f(a){return angular.isDefined(a)&&null!==a&&a===!0||"1"===a||"y"===a||"true"===a}var g={};return{restrict:"ECA",require:"^googleMap",scope:{path:"=path",stroke:"=stroke"},link:function(h,i,j,k){return angular.isUndefined(h.path)||null===h.path||h.path.length<2||!c(h.path)?(a.error("polyline: no valid path attribute found"),void 0):(b(function(){var a=k.getMap(),b=d(h.path),c=angular.extend({},g,{map:a,path:b,strokeColor:h.stroke&&h.stroke.color,strokeOpacity:h.stroke&&h.stroke.opacity,strokeWeight:h.stroke&&h.stroke.weight}),i=new google.maps.Polyline(c);f(j.fit)&&e(a,b),h.$watch("path",function(b,c){if(b!==c)if(b){var g=d(b);i.setMap(a),i.setPath(g),f(j.fit)&&e(a,g)}else i.setMap(null)},!0),h.$on("$destroy",function(){i.setMap(null)})}),void 0)}}}]),angular.module("google-maps").directive("window",["$log","$timeout","$compile","$http","$templateCache",function(a,b,c,d,e){return new directives.api.Window(a,b,c,d,e)}]);